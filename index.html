<script>
    async function startJavaApp() {
        const statusLabel = document.getElementById('status');
        
        // 1. Helper function to wait until the CheerpJ library is actually ready
        const waitForCheerpJ = () => {
            return new Promise((resolve) => {
                const check = () => {
                    if (typeof cheerpjInit !== 'undefined') {
                        resolve();
                    } else {
                        setTimeout(check, 100); // Check every 100ms
                    }
                };
                check();
            });
        };

        try {
            statusLabel.innerText = "Waiting for CheerpJ Loader...";
            await waitForCheerpJ();

            statusLabel.innerText = "Loading JVM...";
            await cheerpjInit();
            
            cheerpjCreateDisplay(800, 600, document.getElementById("container"));
            
            statusLabel.innerText = "Running Sun Position Application...";
            // Note: Ensure your JAR is named SunJava.jar exactly as shown here
            await cheerpjRunJar("/app/SunJava.jar");
            
            statusLabel.innerText = "Application Running.";
        } catch (error) {
            statusLabel.innerText = "Error loading application. Check console (F12).";
            console.error("CheerpJ Startup Error:", error);
        }
    }

    // Trigger the start
    window.addEventListener('load', startJavaApp);
</script>
