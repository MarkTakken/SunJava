<script>
        async function runCheerpJ() {
            const statusLabel = document.getElementById('status');
            
            try {
                statusLabel.innerText = "Initializing JVM (Java 17 Mode)...";
                if (typeof cheerpjInit === 'undefined') throw new Error("CheerpJ library missing.");

                await cheerpjInit({ version: 17 });
                
                statusLabel.innerText = "Creating Display...";
                cheerpjCreateDisplay(680, 350, document.getElementById("container"));
                
                statusLabel.innerText = "Downloading Application...";
                
                // Path construction with Cache Busting
                let folderPath = window.location.pathname;
                if (folderPath.endsWith("index.html")) {
                    folderPath = folderPath.substring(0, folderPath.lastIndexOf('/'));
                }
                if (!folderPath.endsWith("/")) {
                    folderPath += "/";
                }
                
                const cacheBuster = new Date().getTime();
                const jarPath = `/app${folderPath}SunJava.jar?v=${cacheBuster}`;
                
                console.log("Loading JAR from:", jarPath); 
                
                // --- THE FIX ---
                // 1. We REMOVE "await". We don't want to wait for the app to close.
                // 2. We chain a .catch() to handle errors since we aren't awaiting it anymore.
                cheerpjRunJar(jarPath).catch(e => {
                    statusLabel.style.display = 'block';
                    statusLabel.className = 'error';
                    statusLabel.innerText = "Runtime Error: " + e;
                });
                
                // 3. Force the label to disappear immediately
                statusLabel.style.display = 'none';
                
            } catch (e) {
                statusLabel.className = "error";
                statusLabel.innerText = "Runtime Error: " + e;
                console.error(e);
            }
        }

        function waitForLibrary(attempts = 0) {
            if (typeof cheerpjInit !== 'undefined') {
                runCheerpJ();
            } else {
                if (attempts > 100) return;
                setTimeout(() => waitForLibrary(attempts + 1), 100);
            }
        }

        function loadCheerpJLibrary() {
            const script = document.createElement('script');
            script.src = "https://cjrtnc.leaningtech.com/4.2/loader.js";
            script.onload = () => waitForLibrary();
            script.onerror = () => document.getElementById('status').innerText = "Network Error.";
            document.head.appendChild(script);
        }

        loadCheerpJLibrary();
    </script>
